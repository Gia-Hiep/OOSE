package com.app.service; 

import com.app.dao.CustomerDAO; 
import com.app.dto.Customer;

import java.util.List; 

/**
 * VN_Service xu ly logic tim kiem khach hang.
 */
public class CustomerSearchService { // VN_Khai bao class CustomerSearchService

    /**
     * VN_So dong toi da tren mot trang.
     */
    public static final int PAGE_SIZE = 15; // VN_Khai bao kich thuoc trang

    /**
     * VN_DAO thao tac du lieu khach hang.
     */
    private final CustomerDAO customerDAO; // VN_Khai bao bien DAO

    /**
     * VN_Constructor khoi tao service voi DAO.
     *
     * @param customerDAO DAO khach hang
     */
    public CustomerSearchService(CustomerDAO customerDAO) { // VN_Constructor
        this.customerDAO = customerDAO; // VN_Gan DAO vao bien instance
    }

    /**
     * VN_Khoi tao du lieu tim kiem tu man hinh login.
     *
     * @param loginUserName ten nguoi dang nhap
     * @return SearchResult ket qua tim kiem ban dau
     */
    public SearchResult initFromLogin(String loginUserName) { // VN_Init du lieu tu login

        String customerName = ""; // VN_Gia tri ten khach hang mac dinh rong
        String sex = ""; // VN_Gia tri gioi tinh mac dinh rong
        String birthdayFrom = ""; // VN_Gia tri ngay sinh tu mac dinh rong
        String birthdayTo = ""; // VN_Gia tri ngay sinh den mac dinh rong

        int page = 1; // VN_Trang mac dinh la trang dau tien

        int total =
                customerDAO.countSearch(
                        customerName,
                        sex,
                        birthdayFrom,
                        birthdayTo); // VN_Dem tong so record thoa dieu kien

        int lastPage =
                (total == 0)
                        ? 1
                        : (int) Math.ceil(total * 1.0 / PAGE_SIZE); // VN_Tinh tong so trang

        int offset =
                (page - 1) * PAGE_SIZE; // VN_Tinh so dong bo qua de phan trang

        List<Customer> rows =
                customerDAO.search(
                        customerName,
                        sex,
                        birthdayFrom,
                        birthdayTo,
                        offset,
                        PAGE_SIZE); // VN_Lay danh sach khach hang trang dau

        return new SearchResult(
                loginUserName, // VN_Ten nguoi dang nhap
                customerName, // VN_Dieu kien ten khach hang
                sex, // VN_Dieu kien gioi tinh
                birthdayFrom, // VN_Dieu kien ngay sinh tu
                birthdayTo, // VN_Dieu kien ngay sinh den
                rows, // VN_Danh sach khach hang
                total, // VN_Tong so record
                page, // VN_Trang hien tai
                lastPage // VN_Tong so trang
        ); // VN_Tra ve doi tuong SearchResult
    }
}
